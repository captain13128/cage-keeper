language: python

os:
  - linux

python:
  - 3.6

cache: pip

before_cache:
  - rm -f $HOME/.cache/pip/log/debug.log

before_install:
  - sudo apt-get update
  - sudo apt-get -y install python3-pip
  - sudo pip3 install awscli

install:
  - pip install $(cat requirements.txt $(find lib -name requirements.txt | sort) | sort | uniq | sed 's/ *== */==/g')
  - pip install -r requirements-dev.txt

script:
  - ./test.sh

after_success:
  - codecov

deploy:
  - provider: script
    script: bash ./.travis/build-deploy.sh prod us-east-1
    on:
      branch: TO-779-dockerize-cage-keeper

notifications:
  email: false

env:
  global:
  - secure: "von+qsbOesm/vsjl+4SBpQT9dFrrnfpUkNmt/jcoZi7XCkMP0xAB17T5T4m72J/ozSCR5i5teKzsmcQUohAEQLo/9aQysPOI47ebg8UFBaW1WAYpd4O6PORXlO1R4wRQhBllJcA6ffgRobKYKs6HtghijWDtGzeACRU5+31nZMa3PeCRU+hBeiTzMjzXO/UkNgMeM6+/GbdFvWidx8+ijx/B0skPUGGT4Mztl7luTAMDy0B26xKgNCKPUfG1IQOrGfl/6GCIWhdzmnkqtQ7QoGpsXztEtK4Tct0szhBhiq/8bxyETAITyJOwYpO/cninTz2IOviTGOHlXq4gaYP38BbH62gGlnY2mGEgKJIOZPi1L0vrIJXV/kAfFFHWKDZMGYYBOh8C0REdkp2C5LKvPGuBoK0Qz+6zUWSP0Yj2mh9+I6Pa6WNhQ5q7wIXU/cDXdySIRcShKaVCdz3O8ZCpPD1qDlPK5E7cycfUlDrPCr3W52XQD/n6oROAZUVTKrOsdHwZ4r1pIEG//lKYLICPBKNrI26bqWTbcoymaccaydemi3OCmGiB1mkFF3vFcCLO9lQa2hk1mr6gCHUOf+eZZdnPSC3bWBBryvfUJKWEtnUHf16zoLTYJlRzIwscDq4SMoNNr3La/DmpBynqi7q1ncBR/tgM4nm0bUF1BrPn8Go="
  - secure: "rUc1D3KfcjP3Cx9cIhGdyfpTQ6wkGO+35pQc4Ls9jEKyfFWTbZQbAqdRefemySFW3IMDKA0nGHUPINvNQLMGKrYSWo9p8vvCWo1FydMDZWZsy5Q8JdXBX8/ZKnW7f21liIw76As1tTRKhWYgEcUsaCVgn3TYeZqnw10jEvh9f85Bh0wsvRjOjNjXim++zYTGOpIQztU8TxuyDIUGAXge9sWHh9ZhOuiO1j08QK3hLzOv2riLrQeduWSOFAxXxhgfimUhAMNyFX/hYdX8QhJsycz2x1IxiqFeBq70SOrfMrygRyORv7P0fGWYuCBwOt6fwYtqnc919N3sLbsyPI1pO8A1LOI7KTwtRar17AA1BK0VFTPlXMM7xUdF+PS7TEKBqfszExvrcEaRRQqLmSHx910sN455pQs5Q9Cil0AbwTZ4/7pMx8mx6AgVXiQ0wcR3VcljshVKQdwnzvoUzaxe2bbbXfcRM2txFkRuGpeKDxjAah3EfzExgKxtBuuIZjj4d6FTv0D12BtxJPRGREOSLz37rs7Z+o8WSat/J3xq+EIKk9l+zyOTzS2CjycfAMxV01Eu33XrXVMMCn4tX9J2FV1kmce7/1XM8bmSEcwNbsc+7XYSoEFApdwBm938oiiXlhYir9sKHJcKaanVhGfnG3nT/il1ALXsifo3Sc9Zzjo="
  - secure: "kEyq0h4LWJli2pna8nYdCwlN2inENZ8aTTUwopJMOixXIlIRsDPa6eL1fGKq5P/C2WiACM3g+e+5oWjmTo3HoxnpWoirtFhmXVlcIobhs9H1vqGZ7jQRGtr3337vPksoXuaSxcfpWYJepvUeW20qQBBfZIaxHsRWPi0piaYFE1j+T/T3Q7CbjWlIkyJliy1JnasyzaMbEnfkc3HoiP56mZeoh+7iT8t1HQmOVwdxejEpklcgheGRXjuFNt7lcJr3tI8zJPprCOsj5YQ93Q67eId3W22fuQW9RIZ1zECHWMDn2qkNiXKWCRBOOAFb+x1Ktvym7TEplRPR+VlsOcQSfogchG4osKxkpmwN1AWWl1vwTdQPmt/jyPeo6EEsb6SX/BptFOzht1u6dl7aOO0vkaJHct4plR1UUXWFfUDqjLenDHyqGoFAlMnyHwCHzx21JzvlkYdQ0JHxFiimT6H3FeyE2+Zy03jX5I3e9NC+agFqB/81QIELBYFTzuLVg3BMTJO4LlDgpOWuP0PrYoOzxn3QKjgMwVLh3BZVUaOKNj90gs48Hs/2RQlTp/LvT81+9tf9EeV6FK3pGMfwEo+5R03Z2DdfeX8VijcZYj8WlvL6L9Kmy9zn85zcILusbU1+PWRq3JHzP5zbsaC+oqLBRVJaUbo7PdiuaQkQBXGGDw4="
  - secure: "sWNLrTy9T0YopplpBWx44rDXbkWpIM6GpljYZb9kEfpCmhgZjGdsdBEXj3/CkBkvL+mYrNxMND2/2N2yfI3jFM+tee3Hgr3eLROKidSAWeOUdGqKVWP4/FMQ0M8P6awa8L2b4gt2VOHNoKfJo88p2fSFXKLTZCrsaKJWs9DZ41a7skS3hQU14FsFQjLTGdKZin3P0s4GRk7QbXG4TCHZbQFFQz1Z3NeLI/W4rppn/L7THDHIjtY0fHXEysI1LPiV5j3+Sv083pB0DZCHRihpCgEzyF8LyVqMbB8wJ3VwCLGGHxr1E98dAIby6NN6RDXWsJrG1DQDjBm0vvEP4Q29Rj00cl2fFmZ1AYbQEX5MniBiNFXRX6y2UdCeq6fzQYY7YVrhEmsFWsU92xajJZvOrpzFLy+XyRqEFzzU+VaEFs7ZCDeNRLNSB5XV+l8puOY7tW1p7zf4bs9eJR3CasI9CQXv+OnX5gPXKYmzTaOdGpCLhjMtrbW9KZXVUn3Vg0p4jVBwElGRB4NQxnX4dCc1z7tDvTKSXFfTfAKw0Nqyu6b5wOaO9iMitoMStq649sZQVA0/yUBN/ocRVDws6r20OZIsbZxMjeNsbT58XeF/shzplQYEuzqG9/5J+iM0KozLbmtsBSL/8Q+DgCPcDk6uEu+LhahjrFGxp0IefUto1FU="